
{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "description": "Represents a user's public profile information.",
      "type": "object",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        }
      },
      "required": ["uid", "displayName", "email"]
    },
    "JobApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JobApplication",
      "type": "object",
      "description": "Represents a job application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the JobApplication entity."
        },
        "company": {
          "type": "string",
          "description": "The name of the company."
        },
        "role": {
          "type": "string",
          "description": "The role applied for."
        },
        "jobDescriptionLink": {
          "type": "string",
          "description": "Link to the job description.",
          "format": "uri"
        },
        "applicationDate": {
          "type": "string",
          "description": "The date the application was submitted.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "The location of the job (Remote or City, Country)."
        },
        "status": {
          "type": "string",
          "description": "Current status of the application in the pipeline. Reference to PipelineStage."
        },
        "pipelineStageId": {
          "type": "string",
          "description": "Reference to PipelineStage. (Relationship: PipelineStage 1:N JobApplication)"
        },
        "isArchived": {
          "type": "boolean",
          "description": "Indicates if the job application is archived."
        }
      },
      "required": [
        "id",
        "company",
        "role",
        "applicationDate",
        "location",
        "status",
        "pipelineStageId",
        "isArchived"
      ]
    },
    "PipelineStage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PipelineStage",
      "type": "object",
      "description": "Represents a stage in the job application pipeline.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PipelineStage entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the pipeline stage (e.g., Applied, Recruiter Call)."
        },
        "order": {
          "type": "number",
          "description": "The order of the stage in the pipeline."
        }
      },
      "required": [
        "id",
        "name",
        "order"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
            "entityName": "UserProfile",
            "schema": {
                "$ref": "#/entities/UserProfile"
            },
            "description": "Stores public user profile information."
        }
      },
      {
        "path": "/users/{userId}/jobApplications/{jobApplicationId}",
        "definition": {
          "entityName": "JobApplication",
          "schema": {
            "$ref": "#/entities/JobApplication"
          },
          "description": "Stores job applications for each user. Uses path-based ownership for secure access. No denormalized data is needed since access is directly based on the user ID in the path.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the job application."
            },
            {
              "name": "jobApplicationId",
              "description": "The ID of the job application."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pipelineStages/{pipelineStageId}",
        "definition": {
          "entityName": "PipelineStage",
          "schema": {
            "$ref": "#/entities/PipelineStage"
          },
          "description": "Stores pipeline stages for each user. Uses path-based ownership for secure access. No denormalized data is needed since access is directly based on the user ID in the path.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the pipeline stage."
            },
            {
              "name": "pipelineStageId",
              "description": "The ID of the pipeline stage."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. Authorization Independence is achieved by avoiding `get()` calls in security rules, ensuring that operations are atomic and easier to debug. The design leverages structural segregation and access modeling to simplify security rules.\n\nUser profiles are stored in a top-level `users` collection to allow for public access to basic profile information if needed in the future, while still being secure by default. Job Applications are stored under each user's document to enforce clear ownership. Pipeline Stages are also stored under the user document. This design uses path-based ownership (`/users/{userId}/jobApplications/{jobApplicationId}`) for private data and hierarchical paths for user-owned entities. All documents in a collection share the same security requirements, and consistent patterns are used for authorization using path based ownership."
  }
}
